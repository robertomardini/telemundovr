<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Estadio VR con A-Frame y HLS (Audio In-Scene)</title>
    <meta name="description" content="Estadio VR con control de audio dentro de la escena" />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      /* Ocultar el video sin usar display:none */
      #videoLive {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <!-- Fuente de vídeo y audio -->
    <video
      id="videoLive"
      autoplay
      playsinline
      webkit-playsinline
      crossorigin="anonymous"
    ></video>

    <a-scene vr-mode-ui="enabled: true" embedded>
      <!-- Cámara + cursor -->
      <a-entity position="0 1.6 0">
        <a-camera look-controls wasd-controls-enabled="false">
          <!-- Cursor para ratón y VR controllers -->
          <a-entity
            cursor="rayOrigin: mouse"
            raycaster="objects: .interactive"
            position="0 0 -0.5"
          >
            <a-ring
              color="#FFF"
              radius-inner="0.005"
              radius-outer="0.01"
            ></a-ring>
          </a-entity>
        </a-camera>
      </a-entity>

      <!-- Suelo -->
      <a-plane rotation="-90 0 0" width="100" height="100" color="#2e2e2e"></a-plane>

      <!-- Pantalla de vídeo -->
      <a-video
        src="#videoLive"
        width="16"
        height="9"
        position="0 4 -15"
      ></a-video>

      <!-- Gradas -->
      <a-cylinder
        position="0 5 -15"
        radius="30"
        height="10"
        color="#444"
        side="double"
        segments-radial="64"
        open-ended="true"
        theta-length="180"
      ></a-cylinder>

      <!-- Botón virtual de audio -->
      <a-entity
        id="audioControl"
        class="interactive"
        geometry="primitive: plane; width: 1; height: 0.3"
        material="color: #000; opacity: 0.7"
        text="value: Audio: On; align: center; width: 1.5; color: #FFF"
        position="0 2 -2"
      ></a-entity>

      <!-- Iluminación -->
      <a-light type="ambient" intensity="1"></a-light>
      <a-light type="directional" intensity="0.5" position="0 10 0"></a-light>
    </a-scene>

    <script>
      // 1) Cargar HLS
      var video = document.getElementById('videoLive');
      var src = 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';

      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(src);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          // al cargar, dejamos el audio desactivado inicialmente
          video.muted = true;
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
        video.muted = true;
        video.addEventListener('loadedmetadata', () => video.play());
      }

      // 2) Control de audio dentro de la escena
      var audioBtnEnt = document.getElementById('audioControl');
      var audioOn = false;

      audioBtnEnt.addEventListener('click', function () {
        audioOn = !audioOn;
        video.muted = !audioOn;
        // Actualiza el texto del botón
        this.setAttribute(
          'text',
          'value',
          audioOn ? 'Audio: On' : 'Audio: Off'
        );
      });
    </script>
  </body>
</html>
