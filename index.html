<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>VR Stadium – Gradas y Pantalla Curva</title>
    <meta name="description" content="Entorno VR con gradas en semicírculo y pantalla curva con vídeo en vivo" />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Three.js (para convertir ángulos) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      /* Posicionar los botones de VR / fullscreen */
      .a-enter-vr-button,
      .a-fullscreen-button {
        position: fixed !important;
        bottom: 20px !important;
        width: 40px !important;
        height: 40px !important;
        z-index: 9999 !important;
      }
      .a-enter-vr-button { left: calc(50% - 30px) !important; }
      .a-fullscreen-button { left: calc(50% + 10px) !important; }
    </style>
  </head>

  <body>
    <!-- Vídeo oculto que alimenta la textura -->
    <video
      id="videoLive"
      autoplay
      muted
      playsinline
      webkit-playsinline
      crossorigin="anonymous"
      style="display: none;"
    ></video>
    <a-assets>
      <video id="videoTexture" src="#videoLive" autoplay loop crossorigin="anonymous"></video>
    </a-assets>

    <a-scene embedded vr-mode-ui="enabled: true">
      <!-- Rig con cámara y controles básicos -->
      <a-entity position="0 1.6 0">
        <a-camera wasd-controls-enabled="false"></a-camera>
      </a-entity>

      <!-- Suelo debajo de las gradas -->
      <a-plane rotation="-90 0 0" width="100" height="100" color="#222"></a-plane>

      <!-- Gradas semicirculares -->
      <a-cylinder
        position="0 2 -5"
        rotation="0 180 0"
        radius="8"
        height="4"
        open-ended="true"
        side="double"
        theta-length="90"
        material="color: #555; opacity: 0.9"
      ></a-cylinder>

      <!-- Asientos: generados por script -->
      <a-entity id="seats"></a-entity>

      <!-- Pantalla curva: cilindro abierto con textura de vídeo -->
      <a-cylinder
        position="0 3 -10"
        rotation="0 180 0"
        radius="10"
        height="6"
        open-ended="true"
        theta-length="90"
        material="shader: flat; src: #videoTexture"
      ></a-cylinder>

      <!-- Iluminación suave -->
      <a-light type="ambient" intensity="0.6"></a-light>
      <a-light type="directional" intensity="0.8" position="0 10 -5"></a-light>
    </a-scene>

    <script>
      // 1) Cargar el stream HLS en el <video> oculto
      var video = document.getElementById('videoLive');
      var streamURL = 'https://live-hls-web-aje.getaj.net/AJE/index.m3u8';
      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(streamURL);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.muted = false;
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = streamURL;
        video.addEventListener('loadedmetadata', function () {
          video.muted = false;
          video.play();
        });
      }

      // 2) Generar asientos en semicírculo
      var filas = 5;
      var asientosPorFila = 10;
      var radioGradas = 8.4; // un poco más que el radio interior
      var seatsEntity = document.getElementById('seats');

      for (let fila = 0; fila < filas; fila++) {
        for (let i = 0; i < asientosPorFila; i++) {
          var angleDeg = -45 + (90 / (asientosPorFila - 1)) * i;
          var angleRad = THREE.Math.degToRad(angleDeg);
          var x = Math.sin(angleRad) * radioGradas;
          var z = -5 + Math.cos(angleRad) * radioGradas;
          var y = 0.3 + fila * 0.4;

          var seat = document.createElement('a-box');
          seat.setAttribute('depth', '0.5');
          seat.setAttribute('width', '0.5');
          seat.setAttribute('height', '0.3');
          seat.setAttribute('material', 'color:#333');
          seat.setAttribute('position', `${x} ${y} ${z}`);
          seatsEntity.appendChild(seat);
        }
      }
    </script>
  </body>
</html>
