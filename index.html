<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Estadio VR con Modelo 3D</title>
    <meta
      name="description"
      content="Estadio VR con HLS en vivo, panel 3D de controles, vídeo 2D tras VR y modelo glTF de estadio"
    />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      /* Vídeo 2D al salir de VR */
      #videoLive {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto;
        z-index: 1000;
      }
      /* Ocultar vídeo mientras se esté en VR */
      #videoLive.hidden {
        display: none;
      }
      /* Botones VR/fullscreen centrados abajo */
      .a-enter-vr-button,
      .a-fullscreen-button {
        position: fixed !important;
        bottom: env(safe-area-inset-bottom, 20px) !important;
        width: 40px !important;
        height: 40px !important;
        z-index: 9999 !important;
      }
      .a-enter-vr-button {
        left: calc(50% - 30px) !important;
      }
      .a-fullscreen-button {
        left: calc(50% + 10px) !important;
      }
    </style>
  </head>
  <body>
    <!-- Vídeo oculto en 2D mientras esté en VR -->
    <video
      id="videoLive"
      class="hidden"
      autoplay
      playsinline
      webkit-playsinline
      crossorigin="anonymous"
    ></video>

    <a-scene vr-mode-ui="enabled: true" embedded>
      <!-- Definición de assets: modelo glTF -->
      <a-assets>
        <a-asset-item
          id="stadiumModel"
          src="soccer_stadium/scene.gltf"
        ></a-asset-item>
      </a-assets>

      <!-- Rig con cámara y controllers a 1.6 m -->
      <a-entity id="rig" position="0 1.6 0">
        <a-camera wasd-controls-enabled="false"></a-camera>
        <a-entity
          laser-controls="hand: left"
          raycaster="objects: .interactive"
        ></a-entity>
        <a-entity
          laser-controls="hand: right"
          raycaster="objects: .interactive"
        ></a-entity>
      </a-entity>

      <!-- Suelo -->
      <a-plane
        rotation="-90 0 0"
        width="100"
        height="100"
        color="#2e2e2e"
      ></a-plane>

      <!-- Modelo 3D del estadio -->
      <a-entity
        gltf-model="#stadiumModel"
        position="0 0 -15"
        rotation="0 180 0"
        scale="2 2 2"
      ></a-entity>

      <!-- Pantalla curva de vídeo -->
      <a-cylinder
        position="0 5 -20"
        rotation="0 180 0"
        radius="15"
        height="9"
        open-ended="true"
        side="double"
        theta-length="120"
        material="shader: flat; src: #videoLive"
      ></a-cylinder>

      <!-- Panel de controles + Salir -->
      <a-entity position="0 1.5 -2">
        <a-plane
          width="2.4"
          height="0.4"
          color="#222"
          material="opacity:0.8"
        ></a-plane>
        <a-entity
          id="btnPlay"
          class="interactive"
          geometry="primitive: plane; width: 0.4; height: 0.2"
          material="color: #0A74DA"
          text="value: Play; align: center; width: 1.5; color: #FFF"
          position="-1.0 0 0.01"
        ></a-entity>
        <a-entity
          id="btnVolDown"
          class="interactive"
          geometry="primitive: plane; width: 0.2; height: 0.2"
          material="color: #555"
          text="value: -; align: center; width: 0.5; color: #FFF"
          position="-0.4 0 0.01"
        ></a-entity>
        <a-entity
          id="volText"
          text="value: Vol: 100%; align: center; width: 1.2; color: #FFF"
          position="0.4 0 0.01"
        ></a-entity>
        <a-entity
          id="btnVolUp"
          class="interactive"
          geometry="primitive: plane; width: 0.2; height: 0.2"
          material="color: #555"
          text="value: +; align: center; width: 0.5; color: #FFF"
          position="0.8 0 0.01"
        ></a-entity>
        <a-entity
          id="btnExit"
          class="interactive"
          geometry="primitive: plane; width: 0.3; height: 0.2"
          material="color: #DA0A0A; opacity: 0.8"
          text="value: Salir; align: center; width: 1; color: #FFF"
          position="1.3 0 0.01"
        ></a-entity>
      </a-entity>

      <!-- Iluminación -->
      <a-light type="ambient" intensity="1"></a-light>
      <a-light
        type="directional"
        intensity="0.5"
        position="0 10 0"
      ></a-light>
    </a-scene>

    <script>
      // --- STREAM EN VIVO HLS (Al Jazeera 24/7) ---
      var video = document.getElementById('videoLive');
      var videoSrc =
        'https://live-hls-web-aje.getaj.net/AJE/index.m3u8';

      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.muted = false;
          video.volume = 1.0;
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
        video.muted = false;
        video.volume = 1.0;
        video.addEventListener('loadedmetadata', function () {
          video.play();
        });
      }

      // --- CONTROLES 3D ---
      var btnPlay = document.getElementById('btnPlay');
      var btnVolUp = document.getElementById('btnVolUp');
      var btnVolDown =
        document.getElementById('btnVolDown');
      var volText = document.getElementById('volText');
      var btnExit = document.getElementById('btnExit');

      function updateVolText() {
        volText.setAttribute(
          'text',
          'value',
          'Vol: ' + Math.round(video.volume * 100) + '%'
        );
      }

      btnPlay.addEventListener('click', function () {
        if (video.paused) {
          video.play();
          this.setAttribute('text', 'value', 'Pause');
        } else {
          video.pause();
          this.setAttribute('text', 'value', 'Play');
        }
      });

      btnVolUp.addEventListener('click', function () {
        video.volume = Math.min(1, video.volume + 0.1);
        updateVolText();
      });

      btnVolDown.addEventListener('click', function () {
        video.volume = Math.max(0, video.volume - 0.1);
        updateVolText();
      });

      // --- MOSTRAR/OCULTAR VÍDEO 2D AL ENTRAR/SALIR DE VR ---
      var sceneEl =
        document.querySelector('a-scene');

      sceneEl.addEventListener('enter-vr', function () {
        video.classList.add('hidden');
        video.controls = false;
      });

      sceneEl.addEventListener('exit-vr', function () {
        video.classList.remove('hidden');
        video.controls = true;
      });

      // --- BOTÓN SALIR VR ---
      btnExit.addEventListener('click', function () {
        var scene = document.querySelector(
          'a-scene'
        );
        if (scene.exitVR) {
          scene.exitVR();
        }
      });
    </script>
  </body>
</html>
