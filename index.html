<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Estadio VR A-Frame + Meta Quest (sin “mira”)</title>
    <meta
      name="description"
      content="Estadio VR con control de audio in-scene y soporte Meta Quest, sin cursor central"
    />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      /* 1) Ocultar el <video> sin usar display:none */
      #videoLive {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        pointer-events: none;
      }
      /* 2) Botón virtual de audio inherente a escena (no aplica aquí) */
      /* 3) Ajustes para botones VR/fullscreen si aparecen */
      .a-enter-vr-button,
      .a-fullscreen-button {
        position: fixed !important;
        bottom: env(safe-area-inset-bottom, 20px) !important;
        width: 40px !important;
        height: 40px !important;
        padding: 0 !important;
        margin: 0 !important;
        z-index: 9999 !important;
      }
      .a-enter-vr-button {
        left: calc(50% - 30px) !important;
      }
      .a-fullscreen-button {
        left: calc(50% + 10px) !important;
      }
    </style>
  </head>
  <body>
    <!-- Fuente de vídeo y audio -->
    <video
      id="videoLive"
      autoplay
      playsinline
      webkit-playsinline
      crossorigin="anonymous"
    ></video>

    <a-scene vr-mode-ui="enabled: true" embedded>
      <!-- Rig: cámara + controladores -->
      <a-entity id="rig" position="0 1.6 0">
        <!-- Cámara sin cursor central -->
        <a-camera wasd-controls-enabled="false"></a-camera>
        <!-- Controladores Meta Quest -->
        <a-entity
          laser-controls="hand: left"
          raycaster="objects: .interactive"
        ></a-entity>
        <a-entity
          laser-controls="hand: right"
          raycaster="objects: .interactive"
        ></a-entity>
      </a-entity>

      <!-- Suelo -->
      <a-plane
        rotation="-90 0 0"
        width="100"
        height="100"
        color="#2e2e2e"
      ></a-plane>

      <!-- Pantalla de vídeo -->
      <a-video
        src="#videoLive"
        width="16"
        height="9"
        position="0 4 -15"
      ></a-video>

      <!-- Gradas -->
      <a-cylinder
        position="0 5 -15"
        radius="30"
        height="10"
        color="#444"
        side="double"
        segments-radial="64"
        open-ended="true"
        theta-length="180"
      ></a-cylinder>

      <!-- Botón virtual de audio -->
      <a-entity
        id="audioControl"
        class="interactive"
        geometry="primitive: plane; width: 1; height: 0.3"
        material="color: #000; opacity: 0.7"
        text="value: Audio: On; align: center; width: 1.5; color: #FFF"
        position="0 2 -2"
      ></a-entity>

      <!-- Iluminación -->
      <a-light type="ambient" intensity="1"></a-light>
      <a-light type="directional" intensity="0.5" position="0 10 0"></a-light>
    </a-scene>

    <script>
      // --- Carga HLS ---
      var video = document.getElementById('videoLive');
      var src =
        'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';

      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(src);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.muted = false; // arranca con audio activo
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
        video.muted = false;
        video.addEventListener('loadedmetadata', () => video.play());
      }

      // --- Control de audio in-scene ---
      var audioBtnEnt = document.getElementById('audioControl');
      var audioOn = true;
      audioBtnEnt.setAttribute('text', 'value', 'Audio: On');

      audioBtnEnt.addEventListener('click', function () {
        audioOn = !audioOn;
        video.muted = !audioOn;
        this.setAttribute(
          'text',
          'value',
          audioOn ? 'Audio: On' : 'Audio: Off'
        );
      });
    </script>
  </body>
</html>
